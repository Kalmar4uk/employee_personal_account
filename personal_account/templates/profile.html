{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="section">
        <h2>Мой профиль</h2>
        <div class="info-blocks">
            <div class="info-block">
                <h3>Личная информация</h3>
                <p><strong>ФИО:</strong> {{ employee.last_name }} {{ employee.first_name }}</p>
                <p><strong>Должность:</strong> {{ employee.job_title }}</p>
                <p><strong>Группа:</strong>
                    {% if group %}
                        <a href="{% url 'users:groups_detail' group.id %}">
                            <button class="profile-btn">{{ group.title }}</button>
                        </a>
                    {% else %}
                        Группа отсутствует
                    {% endif %}
                </p>
            </div>
            
            <div class="info-block">
                <h3>Контактная информация</h3>
                <p><strong>Email:</strong> {{ employee.email }}</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>График работы на октябрь 2025</h2>
        <div class="calendar">
            
            <div class="weekdays">
                <div class="weekday">Пн</div>
                <div class="weekday">Вт</div>
                <div class="weekday">Ср</div>
                <div class="weekday">Чт</div>
                <div class="weekday">Пт</div>
                <div class="weekday">Сб</div>
                <div class="weekday">Вс</div>
            </div>
            
            <div class="days-grid" id="calendar-days">
            </div>
                <div class="calendar-legend">
                <div class="legend-item legend-day-shift">
                    <div class="legend-color"></div>
                    <span>Дневная смена</span>
                </div>
                <div class="legend-item legend-night-shift">
                    <div class="legend-color"></div>
                    <span>Ночная смена</span>
                </div>
                <div class="legend-item legend-day-off">
                    <div class="legend-color"></div>
                    <span>Выходной</span>
                </div>
                <div class="legend-item legend-vacation">
                    <div class="legend-color"></div>
                    <span>Отпуск</span>
                </div>
        </div>
    </div>

        <div class="section">
            <h2>Отпуск на 2025 год</h2>
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Период</th>
                        <th>Дней</th>
                    </tr>
                </thead>
                <tbody>
                    {% for holiday in holidays %}
                    <tr>
                        <td>{{ holiday.first_day|date:"d.m.Y" }} - {{ holiday.last_day|date:"d.m.Y" }}</td>
                        <td>{{ holiday.count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

<script>
    const scheduleData = JSON.parse('{{ calendar|escapejs }}');

    function generateCalendar(year, month) {
        const calendarDays = document.getElementById('calendar-days');
        calendarDays.innerHTML = '';
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const firstDayOfWeek = firstDay.getDay() === 0 ? 7 : firstDay.getDay();
        
        for (let i = 1; i < firstDayOfWeek; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'day day-empty';
            calendarDays.appendChild(emptyDay);
        }
        
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(year, month, day);
            const dateString = formatDate(date);
            const dayData = scheduleData[dateString] || { type: 'day-off', time: 'Выходной' };
            const dayElement = document.createElement('div');
            dayElement.className = `day ${dayData.type}`;
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('current-day');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            
            const dayContent = document.createElement('div');
            dayContent.className = 'day-content';
            dayContent.textContent = dayData.time;
            
            dayElement.appendChild(dayNumber);
            dayElement.appendChild(dayContent);
            
            calendarDays.appendChild(dayElement);
        }
    }
    
    function formatDate(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        generateCalendar(2025, 9);
    });
</script>
{% endblock %}